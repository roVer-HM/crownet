[General]
network = crownet.simulations.vamCluster.World
image-path=../../images
print-undisposed = true
output-scalar-file = ${resultdir}/${configname}/${runid}/${repetition}.sca
output-vector-file = ${resultdir}/${configname}/${runid}/${repetition}.vec
outputvectormanager-class="omnetpp::envir::SqliteOutputVectorManager"
outputscalarmanager-class="omnetpp::envir::SqliteOutputScalarManager"

[Config BaseNR]
description = "Do not run - NR configurations"

**.hasGlobalMap = true

**.identiyRegistryModule = "identiyRegistry"

**.configurator.config = xmldoc("xmlConfigs/ipv4.xml")
**.fbPeriod = 40
**.amcType = "NRAmc"
**.pilotMode = "ROBUST_CQI" 
**.targetBler = 0.01
**.blerShift = 5
**.cellularNic.LteChannelModelType = "NRChannelModel"
**.ueTxPower = 28
**.eNodeBTxPower = 30
**.usePreconfiguredTxParams = true
**.amcMode = "D2D"
**.hasRNISupport = false
**.enableD2DCqiReporting = false
**.d2dCqi = 7

*.carrierAggregation.numComponentCarriers = 1
*.carrierAggregation.componentCarrier[0].numBands =  10

*.gNodeB*.cellInfo.broadcastMessageInterval = 0.5s
*.gNodeB*.cellularNic.numCarriers = 1
*.gNodeB*.cellularNic.channelModel[0].componentCarrierIndex = 0
*.gNodeB*.mobility.initFromDisplayString = true
*.gNodeB*.macCellId = 1
*.gNodeB*.macNodeId = 1

**.tcp.typename = "Tcp"
**.tcp.advertisedWindow = 65535
**.tcp.tcpAlgorithmClass = "TcpReno"
**.tcp.sackSupport = true   

[Config BaseVadereSumo]
description = "Do not run - Base vadere configuration"

**.numTraci = 2

*.traci[1].core.typename = "VadereCore"
*.traci[1].core.version = -1
*.traci[1].core.selfStopping = false
*.traci[1].launcher.typename = "VadereLauncher"
*.traci[1].launcher.hostname = "vadere"
*.traci[1].launcher.port = 9998
*.traci[1].mapper.typename = "VadereModuleMapper"
*.traci[1].mapper.personType = "crownet.nodes.ApplicationLayerPedestrian"
*.traci[1].nodes.typename = "VadereNodeManager"
*.traci[1].nodes.personSinkModule = ".mobility"
*.traci[1].nodes.vehicleSinkModule = ".mobility"
*.traci[1].nodes.personNode = "pNode"
*.traci[1].subscriptions.typename = "VadereSubscriptionManager"
*.traci[1].launcher.seed = ${repetition}

*.traci[0].core.typename = "Core"
*.traci[0].core.version = -1
*.traci[0].core.selfStopping = false
*.traci[0].launcher.typename = "SumoLauncher"
*.traci[0].launcher.hostname = "sumo"
*.traci[0].launcher.port = 9999
*.traci[0].mapper.typename = "BasicModuleMapper"
*.traci[0].mapper.personType = "crownet.nodes.ApplicationLayerPedestrian"
*.traci[0].mapper.vehicleType = "crownet.nodes.ApplicationLayerVehicle"
*.traci[0].nodes.typename = "SumoCombinedNodeManager"
*.traci[0].nodes.personSinkModule = ".mobility"
*.traci[0].nodes.vehicleSinkModule = ".mobility"
*.traci[0].nodes.personNode = "pNode"
*.traci[0].nodes.vehicleNode = "vNode"
*.traci[0].launcher.seed = ${repetition}


**.ignoreVehicle = false
**.ignorePersons = false

*.*Node[*].mobility.visualRepresentation = "^"

*.coordConverter[1].typename = "OsgCoordConverterVadere"
*.coordConverter[1].coreModule ="traci[1].core"
*.pNode[*].**.coordConverterModule = "coordConverter[1]"

*.coordConverter[0].typename = "OsgCoordConverterSumo"
*.vNode[*].**.coordConverterModule = "coordConverter[0]"

*.gloablDensityMap.useSignalMapInit = true

*.*visualization.sceneVisualizer.typename = "SumoSceneCanvasVisualizer"
*.*visualization.sceneVisualizer.zIndex = -1
*.*visualization.sceneVisualizer.coordinateSystemModule = "coordConverter[0]"
*.*visualization.physicalEnvironmentVisualizer.typename = "PhysicalEnvironmentCanvasVisualizer"
*.*visualization.*.typename = ""

*.pNode[*].middleware.DenService.useCases = xml("<usecases/>")
*.pNode[*].useVadere = true

*.vNode[*].vanetza.position.typename = "VehiclePositionProvider"
*.vNode[*].mobility.typename = "artery.inet.VehicleMobility"
*.vNode[*].middleware.DenService.useCases = xmldoc("xmlConfigs/den-use-cases.xml")

[Config BaseNode]
description = "Do not run - Base node configuration"

*.*Node[*].useNR = true
*.*Node[*].cellularNic.numCarriers = 1
*.*Node[*].cellularNic.nrChannelModel[0].componentCarrierIndex = 0
*.*Node[*].nicType = "NRNicUe"
*.*Node[*].cellularNic.mac.amcMode = "D2D"
*.*Node[*].useArtery = true
*.*Node[*].hasWlan = false
*.*Node[*].mobility.visualRepresentation = "^"
*.*Node[*].nrMacCellId = 1
*.*Node[*].nrMacNodeId = 0
*.*Node[*].nrMasterId = 1
*.*Node[*].macCellId = 1
*.*Node[*].masterId = 1
*.*Node[*].middleware.updateInterval = 0.1s # application trigger
*.*Node[*].middleware.datetime = "2022-11-17 14:19:00"
*.*Node[*].middleware.services = xmldoc("xmlConfigs/services.xml")
*.*Node[*].middleware.VaService.*.result-recording-modes = all
*.*Node[*].middleware.CaService.*.result-recording-modes = all

[Config ScenarioBase]
description = "Do not run - Base for scenarios"
extends = BaseNR, BaseNode

[Config BaseLothstrasse]
extends = BaseVadereSumo
description = "Do not run - Base lothstrasse map"

*.traci[0].launcher.sumoCfgBase = absFilePath("combined/lothstrasse/sumo/osm.sumocfg")
*.coordConverter[0].netFile = xmldoc("combined/lothstrasse/sumo/osm.net.xml")
*.visualization.sceneVisualizer.mapFile = xmldoc("combined/lothstrasse/sumo/osm.poly.xml")
*.net_visualization.sceneVisualizer.mapFile = xmldoc("combined/lothstrasse/sumo/osm.net.xml")
**.vadereScenarioPath = "combined/lothstrasse/vadere/scenarios/mf_001_base_44.scenario"
*.physicalEnvironment.config = xmldoc("combined/lothstrasse/vadere/scenarios/mf_001_base_env.xml")

[Config BaseGen]
extends = BaseVadereSumo
description = "Do not run - Base generated map"

*.traci[0].launcher.sumoCfgBase = absFilePath("combined/generator/sumo.sumocfg")
*.coordConverter[0].netFile = xmldoc("combined/generator/sumo.net.xml")

*.visualization.sceneVisualizer.mapFile = xmldoc("combined/lothstrasse/sumo/osm.poly.xml")

*.net_visualization.sceneVisualizer.mapFile = xmldoc("combined/generator/sumo.net.xml")
**.vadereScenarioPath = "combined/generator/vadere.scenario"

*.physicalEnvironment.config = xmldoc("combined/lothstrasse/vadere/scenarios/mf_001_base_env.xml")

[Config BaseOsm]
extends = BaseVadereSumo
description = "Do not run - Base generated map"

*.physicalEnvironment.config = xml("<environment />")
*.traci[0].launcher.sumoCfgBase = absFilePath("scenario_mf/veh.sumocfg")
*.coordConverter[0].netFile = xmldoc("scenario_mf/mf_base.net.xml")
*.visualization.sceneVisualizer.mapFile = xmldoc("scenario_mf/mf_base.net.xml")
**.vadereScenarioPath = "scenario_mf/mf.scenario"
*.net_visualization.typename = ""

[Config BaseOsm_group]
extends = BaseVadereSumo
description = "Do not run - Base generated map"

*.physicalEnvironment.config = xml("<environment />")
*.traci[0].launcher.sumoCfgBase = absFilePath("scenario_mf/veh.sumocfg")
*.coordConverter[0].netFile = xmldoc("scenario_mf/mf_base.net.xml")
*.visualization.sceneVisualizer.mapFile = xmldoc("scenario_mf/mf_base.net.xml")
**.vadereScenarioPath = "scenario_mf/mf_group.scenario"
*.net_visualization.typename = ""

[Config BaseSimple_group]
extends = BaseVadereSumo
description = "Do not run - Base generated map"

*.physicalEnvironment.config = xml("<environment />")
*.traci[0].launcher.sumoCfgBase = absFilePath("combined_simple/simple.sumocfg")
*.coordConverter[0].netFile = xmldoc("combined_simple/simple.net.xml")
*.visualization.sceneVisualizer.mapFile = xmldoc("combined_simple/simple.net.xml")
**.vadereScenarioPath = "combined_simple/simple.scenario"
*.net_visualization.typename = ""

[Config no_cluster]
description = "Test Scenario"
extends = ScenarioBase
*.*Node[*].middleware.VaService.canLeadCluster = false
*.pNode[*].middleware.VaService.sendsVams = true
*.vNode[*].middleware.VaService.sendsVams = false
*.pNode[*].middleware.VaService.vamWait = uniform(0s,1s)

[Config cluster]
description = "Test Scenario"
extends = ScenarioBase
*.*Node[*].middleware.VaService.canLeadCluster = true
*.pNode[*].middleware.VaService.sendsVams = true
*.vNode[*].middleware.VaService.sendsVams = false
*.pNode[*].middleware.VaService.vamWait = uniform(0s,1s)

[Config test_sim]
extends = cluster, BaseSimple_group
sim-time-limit = 200s

*.pNode[*].middleware.VaService.maxClusterDistance = 4
*.pNode[*].middleware.VaService.maxClusterVelocityDifference = 0.1

[Config study_simple_no_cluster]
extends = no_cluster, BaseSimple_group
sim-time-limit = 200s
repeat = 20

[Config study_simple_velocity_difference]
extends = cluster, BaseSimple_group
sim-time-limit = 200s
repeat = 20
*.pNode[*].middleware.VaService.maxClusterDistance = 4
*.pNode[*].middleware.VaService.maxClusterVelocityDifference = ${N=0.01..0.11 step 0.02}

[Config study_simple_velocity_difference_exceed_standard]
extends = cluster, BaseSimple_group
sim-time-limit = 200s
repeat = 20
*.pNode[*].middleware.VaService.maxClusterDistance = 4
*.pNode[*].middleware.VaService.maxClusterVelocityDifference = ${N=0.01..0.25 step 0.02}



